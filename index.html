<!DOCTYPE html>
<!-- saved from url=(0049)https://getbootstrap.com/docs/4.3/examples/album/ -->
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="google-signin-client_id" content="631540126574-g1496s63kt1vprfla0snr4bm5g3rqcbc.apps.googleusercontent.com">
    <title>eMercado - Login</title>
    <script>
      const userInfoKey = "Logged-User";
      const userLogged = JSON.parse(localStorage.getItem(userInfoKey));
      const URLparams = new URLSearchParams(window.location.search);
      const params = Object.fromEntries(URLparams);
      let requestedLogout = params.logout != null;

      // si está logueado
      if (userLogged) {
        // si no era por deslogueo: redirigir
        if (!requestedLogout) {
          window.location = './home.html';
        }
        // de lo contrario, era con el parámetro logout
        else {
          localStorage.removeItem(userInfoKey);
          if (!userLogged.viagoogle) requestedLogout = false;
        }
      }

      window.history.replaceState({}, document.title, './');

      // revisar si el usuario se deslogueó: asegurarse de cerrar la instancia de google
      function takeAction() {
        if (userLogged && userLogged.viagoogle && requestedLogout) {
          gapi.load('auth2', function(){
            gapi.auth2.init().then(function(){
              gapi.auth2.getAuthInstance().signOut().then(function(){
                localStorage.removeItem(userInfoKey);
                requestedLogout = false;
                document.getElementById('logout-spinner-wrapper').remove();
              });
            });
          });
        }
      }
    </script>
    <link rel="canonical" href="https://getbootstrap.com/docs/4.3/examples/album/">
    <link href="https://fonts.googleapis.com/css?family=Raleway:300,300i,400,400i,700,700i,900,900i" rel="stylesheet">
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
  </head>
  <body>
    <main role="main" class="home pb-5">
      <div class="container">
        <div id="loginForm" class="form-signin">
          <img class="mb-4" src="img/login.png" alt="" width="auto" height="auto" style="margin-left: -15px;">
          <h2 class="text-center p-4">Iniciar sesión</h2>
          <div class="form-label-group">
            <input type="text" id="inputUser" class="form-control" placeholder="Usuario" required>
            <label for="inputUser">Usuario</label>
          </div>
          <div class="form-label-group">
            <input type="password" id="inputPassword" class="form-control" placeholder="Contraseña" required>
            <label for="inputPassword">Contraseña</label>
          </div>
          <button type="submit" id="submitButton" class="btn btn-lg btn-primary btn-block">Entrar</button>
          <p class="mt-5 mb-3 text-muted"></p>
        </div>
        <div id="login-oauth" class="container">
          <p>O mediante Google</p>
          <div class="g-signin2" data-onsuccess="onSignIn"></div>
        </div>
      </div>
    </main>
    <script>
      if (userLogged && userLogged.viagoogle) {
        document.body.innerHTML += `
          <div id="logout-spinner-wrapper"><div class="lds-ellipsis"><div></div><div></div><div></div><div></div></div></div>
        `;
      }
    </script>
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/init.js"></script>
    <script src="js/login.js"></script>
    <script src="https://apis.google.com/js/platform.js?onload=takeAction" async defer></script>
  </body>
</html>
